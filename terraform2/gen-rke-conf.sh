cat <<EOF > ../rke/cluster.yaml

cluster_name: rancher-rke-test

# Maybe change this path later.
ssh_key_path: /home/erik/.ssh/id_rsa

nodes:
  - address: $(terraform output storagemaster-ip)
    user: rancher
    role: [controlplane,etcd]
  - address: $(terraform output storageworker1-ip)
    user: rancher
    role: [worker]
  - address: $(terraform output storageworker2-ip)
    user: rancher
    role: [worker]

services:
  kube-api:
    pod_security_policy: true
    # Add additional arguments to the kubernetes API server
    # This WILL OVERRIDE any existing defaults
    extra_args:
      # Enable audit log to stdout
      audit-log-path: "-"
      # Increase number of delete workers
      delete-collection-workers: 3
      # Set the level of log output to debug-level
      v: 4

  etcd:
    snapshot: true
    creation: 6h
    retention: 24h

ingress: 
  provider: "nginx"
  extra_args:
    default-ssl-certificate: "ingress-nginx/ingress-default-cert"

addons: |-
  ---
  apiVersion: v1
  data:
    tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZhekNDQTFPZ0F3SUJBZ0lVUTA2R2srREVSc3UwcjRGNjZSYTdScUM1OXJNd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1JURUxNQWtHQTFVRUJoTUNRVlV4RXpBUkJnTlZCQWdNQ2xOdmJXVXRVM1JoZEdVeElUQWZCZ05WQkFvTQpHRWx1ZEdWeWJtVjBJRmRwWkdkcGRITWdVSFI1SUV4MFpEQWVGdzB4T1RBM01EZ3dPVEk1TXpCYUZ3MHlNREEzCk1EY3dPVEk1TXpCYU1FVXhDekFKQmdOVkJBWVRBa0ZWTVJNd0VRWURWUVFJREFwVGIyMWxMVk4wWVhSbE1TRXcKSHdZRFZRUUtEQmhKYm5SbGNtNWxkQ0JYYVdSbmFYUnpJRkIwZVNCTWRHUXdnZ0lpTUEwR0NTcUdTSWIzRFFFQgpBUVVBQTRJQ0R3QXdnZ0lLQW9JQ0FRRGQ0SWxUWnFYWUE2bng5dHBVY2htc0lodjFDam9NZDIxWERZa29iUVNwCnA2TFlaZXVRd09WbVhIdVp3SzdYOVVTbWlTU1lod1hRRGloVlBIYmdiYVB3Q3VXVWdQeEVjZ3BDRGVVdzVTRHIKOG9HRkZHVGk0NndZdEV5M2dCNWR6V01Ra2xSRStvZ1JmajlmUWFqRFNLQUlJQjljRVZqT2xlQjczYWhyM2t5QQp6Q3EyVWpMV1dRTElMaWNzRjVvcjRvOGZpNmR2RTR1b3hxMXlIQUk0R0NPS0JETitoUTFBaXpWdzJ3QVAxNXViCmd4MUJYSmdseUQ4RDUwRGhlWDdvMXlFWTc0djFocDc5dXJCM0JmVlA3YWVIS2ZmcTJKM1pBUUE5b3NUUFhUK1EKanRKVmtQZXNISUZJQVJ5eEFJM0FHWjdVTDBtZlZHaGtPR0ZEQW9VREMxQ2FsemhrYzVFR3duM1R4Szczd21mcQptcDI4c1BZNFhid0RnbElOVmxFSVRFOUxFV1huN1pKWjlwR0Q4RHQvbjhLWnV3ZFRicm5uUmNmYmlmREg1RHI2Cnd6OWFHRkFUaVh3VDhTSzB4dWdIRm5ISkNPNnFxSTRnWGNwdzVRa2Z2bnZNNTFhVTFwSW04TS9HRHZ0VW5pQ2cKVk5DbmxodWhHbTRXSWJrbDFyZWZseFZ0YjR6Ry9rWS9Mc3loWlgwVVpJaTFVK0poSThCVVZqZHNuUFJHZWRXUwpma0hleXJWUUN0VFgxUjlGSFpVSDlrcmZaWWd4T0plMUFHNWVHZUZNN0lkNTBXU0RwUlZNT1d1WExOaHZqQklOCnhlbHJZUkFQS0orT09EaXVtUmRFNzNhcGRDL2w1TFV2bk1zL2dGTk5aK3hWZXhURkdXb0ZzUytTMDZSSU5EbkYKNVFJREFRQUJvMU13VVRBZEJnTlZIUTRFRmdRVUlaWGhvR0czLzA3ZndWVndpUE9ZakZiVTJ1QXdId1lEVlIwagpCQmd3Rm9BVUlaWGhvR0czLzA3ZndWVndpUE9ZakZiVTJ1QXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QU5CZ2txCmhraUc5dzBCQVFzRkFBT0NBZ0VBcEtTS2ZrZG1JWkhKcU9JZVZaSk10Z3piNVRObndMbzFxR3JjYUdKNWUrSHkKMUs1TVNsRlQ1cElwY0d5NUhIRzhBam5pZ0VRWitTWTNtdzBOMTlxR1ljYTVJZFF1MCt6ZkkzU0VJWms4Z1hpVApRWFY0ckJuNmtoSXFBYi9yK3U3Qjl4RStOUEhMcDJ2RFZtTXhZSkRnWGkrRnRpMnoraVlwdTUramh5QWhHTGRsCksrMDNXTjZja25Ob1NQVy9Ka01oZFFUNTU0STNpQkpVVjhmeUFIR09OSThHUWEvWFVtcjB6K0pMU2oyNnh0UHcKQmZHWG5sQ1NNcVpTeFRsNUpoa1Q1aklYRzN2Q0ZEZjl4UjRmVHNlT0czRnJ0Skh2ZkF5QWVWeDB5Y3AvZ3JMKwpMb0pIK1lGLy9JM291UmR3STF5WitTVGFXZlY4ZEhPbm9zTFNNclpsQStUdHE5NFhSaTNRZVpJMExyWlZwMUNBCldsWGorR21hTW5MT28xZ0N1SzRndnU2eTQ3cjBzQ291QVVnSWU4WkNZRWkyT1REaE04dUhSeDhhWEZ0UnU2SjkKdU5XVG1MUDZlWUsxanY1QUhXM1pzTlBuZlNYZXVJR0tBUXZuRnFjRUFXdFpFMjVMWnNQRU1JcittTzNBckt6Mgo5cTRJYVZuaWlMK25DTnN5R2wrTmRXdmdOQlBUVStOOXlEL1BkYmRrMEJCc1p0b1JSVG9XZlBsVzZyblZXMmNkCjQzcFlWdW80K2lFSFNyY2MyZlBpamQyMGRKNFNlT3ltZlR5SUhVY083ekRvQmRSV3hqNmFwM0R0QzBUN1ptWTIKekV5SVhRWkF1NUhiTmZ6U3pJdE9MNnM0RGwrUFhQU09KdTRqVGJxSHRnb0xFczBtTW4xM3BRakFXTXFNU2JFPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpSQUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQ1M0d2dna3FBZ0VBQW9JQ0FRRGQ0SWxUWnFYWUE2bngKOXRwVWNobXNJaHYxQ2pvTWQyMVhEWWtvYlFTcHA2TFlaZXVRd09WbVhIdVp3SzdYOVVTbWlTU1lod1hRRGloVgpQSGJnYmFQd0N1V1VnUHhFY2dwQ0RlVXc1U0RyOG9HRkZHVGk0NndZdEV5M2dCNWR6V01Ra2xSRStvZ1JmajlmClFhakRTS0FJSUI5Y0VWak9sZUI3M2FocjNreUF6Q3EyVWpMV1dRTElMaWNzRjVvcjRvOGZpNmR2RTR1b3hxMXkKSEFJNEdDT0tCRE4raFExQWl6Vncyd0FQMTV1Ymd4MUJYSmdseUQ4RDUwRGhlWDdvMXlFWTc0djFocDc5dXJCMwpCZlZQN2FlSEtmZnEySjNaQVFBOW9zVFBYVCtRanRKVmtQZXNISUZJQVJ5eEFJM0FHWjdVTDBtZlZHaGtPR0ZECkFvVURDMUNhbHpoa2M1RUd3bjNUeEs3M3dtZnFtcDI4c1BZNFhid0RnbElOVmxFSVRFOUxFV1huN1pKWjlwR0QKOER0L244S1p1d2RUYnJublJjZmJpZkRINURyNnd6OWFHRkFUaVh3VDhTSzB4dWdIRm5ISkNPNnFxSTRnWGNwdwo1UWtmdm52TTUxYVUxcEltOE0vR0R2dFVuaUNnVk5DbmxodWhHbTRXSWJrbDFyZWZseFZ0YjR6Ry9rWS9Mc3loClpYMFVaSWkxVStKaEk4QlVWamRzblBSR2VkV1Nma0hleXJWUUN0VFgxUjlGSFpVSDlrcmZaWWd4T0plMUFHNWUKR2VGTTdJZDUwV1NEcFJWTU9XdVhMTmh2akJJTnhlbHJZUkFQS0orT09EaXVtUmRFNzNhcGRDL2w1TFV2bk1zLwpnRk5OWit4VmV4VEZHV29Gc1MrUzA2UklORG5GNVFJREFRQUJBb0lDQVFDR2NHMEZLZWRIVWtFQktjLzA1d1lECk5NKzMxRENFS1VFSlJGeGRNR0ZvNHZoYklyWnZpVkgyaWdjaWpJdmtzdXFiOWZGRXNsdWxTMDdKQnRBSkFLWWEKNXA5aE1oNm80bWl3eVhhYi85bkkzYkg1RHZocU9nV25HbWg1cjVtMndLSk1BajRwWlp4WTdTUTg5YTNxVmZFUgp1MVVGRmtXM056MUVFSFRpbDFuSG1PNHdkdkh5eXhCU2R4U3BOTXZuMTJsZGRlTkgvSkhjL0RWUU5RUnJOTVVqCjlaTzJENnlOOVV1MlRCeG5mUDcrWloydVl3cVZxaFgwcVlTNG1rTjVsaENwNlV2bXcyRkc0SDNZUUxYNWJramEKTDJYVzJOWWNETzAyYTQvUkRmRmNDQTRPWnI2TGZPSWczUHVqakhCWGU2NnZacyszU1EvUDJoR2s1cnZ0c2tkdApvMmJob251YUdXcEN0VEpoNXpoVTg1bEYzSSt5LzJUWkx1SVpvMXdmZ1VsSHBXWHpOM0owazhiSnlyYXZoY0pkCi95N3N5ZlJpSlhPSER2OGhQQlJpRm13VE9haDBUbm56WFY5cHMxY29CYkdHRWI0TmpTM3NRTjdXNHRYcXFaRXMKQ3F3eEdzZU4wajJsQ2NndVZad3dYTGpWVnptT1BXd3NSbkF1Y1o0YUgvUW56ZWhsc3JQY0I0eGd3QndBYWtwRQowK0F0a0xJd0NwNkcvSnRjQk5US0hlTWRQcEpCdkl2ZDgxT2czUmU5YTYwajJDeTE0ckZRQ3MyZmU4K1o0VjBICm1QTWJ5SWVTNVN1QUFFRVcxcGdDeVRnZ0E3U2ZlVFg3eDR6M3NPUXVLbjdFU3ZKdnZsWno4ZlgzQkpKampoNncKRjI1a1llbElBNjJpejJiNzhRTVBBUUtDQVFFQThZbUQ0Uzgzei9BeVZIaWw0SWIzcTdKd1dMekRLMkdTMkw5VAprK0JxSWNtd0ZYR1FaTEh0NzJNbFVNNk5VNXFHUFo3RHo0dTRYQ04vVzB1L1RqN2ZBVjBydUhNazVGWGNLeFpUCkY5emhHY0pEQXFlZDQ0WGc0ZDBlVzM2VDdOMm9qRWZaMFNqMXJZVmdqTW96UE5qSVVsK0tRQ2dlU2tVcFM2MzMKbkY4K2RLNllndjlXRmdVTUZGRXZxK3hkbkFYYmhKNyt6aXFhN2JSWHduQzBrcjNxVVFSMHZ2YXNNbVpMK2FsWQo3NTdKbldGV0J0NG9DR2xGNnFqRzhETUNscnBEelcvV01pRkRRUWlDL01RUmZQM21nUzlsZWJ6ZjZuZDY4Mkd2CmpwZnpaRHJyNEo4TUZKUFFlbWI4VXBOd2J3M0oyT1hPVCtHcG9UVEd4THF5WHlMV0lRS0NBUUVBNnltbnR6WDAKTS93K00yTDV5L0lFMFNXS29sTjZ6RjNxNkQxMUszSW8wNHppVzYyaFVLWjZnWVMrN1diNXEzQ250QXVJNWd4Ywo3amlvVnpHRTlpSkk4WjAzV1p5YlhESkM2djc5d1NQMXBOaGx1eWpMSHZzQ2tmZkVoOVdHWk56QldRR0hjT0wrClJUMndMYXJVeC95WS9rVUJieE1uc0VqV3BIcHJlU1ZWOStDUGhKM3I1QnNZUEx6UDd6S0N5QzgwSUtQdklCNEEKNlFmU2hhOStkVWJHeUE2TlV3L05iME1reDNQaVdaMkZMTW1ESllyaWhrYTd2N2tScmllQkFwdGx0V1FwcDN4RgpiNVd0bnl6MkRKeFFBUUVWZmkvNlRhSFpDRFc2d2hBSE1odU5wemxDMEFBS1I1cFJocE9Td1FhdWRVSnI1WkN6CndmYW50NzJ2N2NZdlJRS0NBUUF0Tk5tMENjeGVaTXhtdHZZRTRmMzA2cjdRUFBRaWFHNjlsb0drQ2JxVGZGWXkKalVERE4vSWFmZW44Qjh5M3V4SW84bEFmeGp6Sk1mT2lPTGtqZ2V6bktuTUdZTGFrN2RUNVU0SlYwd2RtZE05cAo3Y2xGVGtkYXZySHgyZTBCeGpMSG5xTUwzS2l1dzJuZ3IrK0xFZC9jV3ZsYkxLY09xNGNoSFB4ZERnNTRkRDBqCk4zcjdRQktVc3VWRFBrZis3Ykc2VHEvT0VuZFF5aElxMkVGVHZhdmZZZ0FmeGJkUTc0aUV2OGRmZ2M2bVlCTmoKMGF5WWRtdVprZUU2RDdJS1YrNWN3dlBLQ2lPMlJrdU4xM3lXY2tiMEl0VFJSaUo2bGNZelN6TTZjd0lnM2s1TAppamtPbU9QS0pRQlF6RHVjN1cyNzVMY0tpR2ZoUGlsOXBKdkI1cGxCQW9JQkFRQ0s2SGdoU01XUFQ1aU9VaENyCjM3SG91UHhERm55YTYzOHUzOTZ1WXlpcWpiWEg0YkJBSzVhQm15QU1xNThmSGRSeURiNDM1V1dmY2VnK1dRbnAKT2lkTVVVbTRyVUU0SEpoYXAzVE0rYWpJVHVzSXV2Z0F2TlN2MUdOS3VWNUJoZ1RQeG85eXB5TDdVNDBWN0tyegoxc21vcUtwSUtsQnZXUmN3NFA5SytEcm55TVg5MkNyVyt3bytGbW5kS1VFSGJwcWtEVEhiRHQ0S3lJd2FXNmVmCkxzZU10TXZXSEtlRTZXeDRSSU9YMit3bW9JSFBVMUtyYm16SXUxRXVSamQyaXNSeGVWRUJsZTZPRXlRVHVrTTgKLzdoaVgzbUtxRng2THZnOFdVQ1FFVmV1eVlmTEY0L1h2YTVVelZzSzIzRDhoQzNaSmZzR0I0dW5MME95eldGMgpXbkxoQW9JQkFRQ0JVM2tabjNEVVVsOU5sSnV1cDluM2Z6L211cjRiR3FjbTlqK3E5eGdjdnc3d1RmOExyZWJmCktkZzZzZ0ZlT0FKTXJtVWhBL1ZteEhsMVRBVk5Wd3lWNGZremxKRlZhNVZ5UndZdXNXVHVPbkxyTUErcDBsUnQKcklqYmdRREc3SnZuNjRZTmNseW1NTVlJM3hGeUJ4UkROTlo1aEg3alNsaEVXT0hmd0ZuaXoraG8xNFNkYnQxbQpJa3dObW1MeWM4U2xJNTZkanlCbW1ubDRFU1JJbmdNa0kxdXc5aFkzb1hPa0dIRmcwZytuWTYrRy9ZbWVVc2t4CittZjNnelorUDJ0ZHlRVVlMUHVyZEc5VGFQWENFK0dOVnAydzhCMUo4a2NocTZ3Wm9MUm9CNGZLa3Nac3ltSWEKTER3RmpVRDBpKzhDcmxKUlVrdXdTa0NvRUZZQWpkOWwKLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLQo=
  kind: Secret
  metadata:
    creationTimestamp: null
    name: ingress-default-cert
    namespace: ingress-nginx
  type: kubernetes.io/tls
EOF