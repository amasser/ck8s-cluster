#!/bin/bash

#
# Script that runs service cluster and worker cluster tests on a local container
#

#
# User inputs necessary
#
echo 'Local repository path (ex /home/user/ck8s):' 
read localPath
echo 'Image repository tag (ex v0.1.0-dev):' 
read repoTag
echo 'Enviorment Variables (ex daniel-test):'
read envVar

#
# Create variables for commands
#
createCreds=$(cat > $localPath/pipeline/test/services/credentials.sh << EOF
export CLOUD_PROVIDER='exoscale'
export ECK_OPS_DOMAIN='ops.$envVar.a1ck.io'
export ECK_BASE_DOMAIN='$envVar.a1ck.io'
export ENABLE_CUSTOMER_GRAFANA='false'
export CUSTOMER_NAMESPACES='demo1 demo2 demo3'
export CUSTOMER_ADMIN_USERS='admin1@example.com admin2@example.com'
EOF)

createScCfg=$(cat > $localPath/kube-bench/cfg/kube_config_eck-sc.yaml << EOF
apiVersion: v1
kind: Config
clusters:
- cluster:
    api-version: v1
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN3akNDQWFxZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKTFdOaE1CNFhEVEl3TURJeU5ERXlNell3TWxvWERUTXdNREl5TVRFeU16WXdNbG93RWpFUU1BNEdBMVVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU1IdXNUT0xxRDdlCkYydWErWTJVclZ0NWZZZDd6YUpSc3paMnRLRmQrUkk1MEZkMFBMVDMweGF0K2trZ210MHBUSnZoamlhSjJCYU4KLzgyeXN5YXQrOHZMd0hQd2ltRlFvK0pBWGZxVnNGK1V6NmZrZ0tyQ2tBUEZwTzc3L0V4OTlXS1g3MUowY291YQpNWUVQemhtT3NMSG5hYkIvZDFwL0FzMUNreS92YUduSk84U0lpRXhYYzduNkZaVkUvWDU0ZldqaUgrRnVUQ1BWCld4UDlxR3pJeDhMM1ExczVVQ2tDQTNad2loZHB4emViT29aWnVmK0JtSUxpRGFjV2pUM0srdkFOVDlkRE9TQzUKWkl4RGgyYXlFYncrbm5xOXArWU9EUWtYZnFjakxtQWsvdENjUUhFaG4wajlob2EyaG54UldTN3BXcTFRM2NnOQprUjJDdy9wWEgxOENBd0VBQWFNak1DRXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93UUZNQU1CCkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRTFCdmRGc254Yk1jZ1FvbTE0K0VtYitXQzVmNi9TaEZoOXAKalp2S2VxZXBybHZNZFZiYVpqdUN1ZFNuaW8ybGxqR0RtNFZWNmtGVzNmTmtCbldYbG1VM29VaDZkOFFTMzQzTQpDTW0yRzMyMUgvUDlMSzZVM1gwNGFqUEQ5OWxFOUlTaEp0aEluTnhFWWNkMHVZUUdMeDByWk9rRXdlbTBmTXdqCjZpVTVrNlJrR1hWbmZ1SVVhdnlqU1dVWXVwdGJ2d25GVmZPQzJaQmMxeW1mdzJYZXpJamFDV1dydEsvamxZTHMKQjlaOWZHdUFsKzZqSU9RaldaWkJELzhLTldlMEhQQnZheFA2UlVFaUNlZUptNVJtYUtwTkxiSENYNFNzbWdGdAp5RGJTUmY1N2ova2tLWEFQSW93WW5iSlJ6bitoVWZ4T1V1U1pFRy82cTlsTm42cE9EMTQ9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: "https://194.182.160.105:6443"
  name: "eck-service_cluster"
contexts:
- context:
    cluster: "eck-service_cluster"
    user: "kube-admin-eck-service_cluster"
  name: "eck-service_cluster"
current-context: "eck-service_cluster"
users:
- name: "kube-admin-eck-service_cluster"
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2VENDQWRHZ0F3SUJBZ0lJTTdLalU2b0lDSXd3RFFZSktvWklodmNOQVFFTEJRQXdFakVRTUE0R0ExVUUKQXhNSGEzVmlaUzFqWVRBZUZ3MHlNREF5TWpReE1qTTJNREphRncwek1EQXlNakV4TWpNMk1EUmFNQzR4RnpBVgpCZ05WQkFvVERuTjVjM1JsYlRwdFlYTjBaWEp6TVJNd0VRWURWUVFERXdwcmRXSmxMV0ZrYldsdU1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTR3NFRWMmQxTVZCMFdiUmo1UVIvZmQ1b3ZtZGkKVXh3THVJOGZwbDBoZ3dzanFnYUJPT1BubFNYMmgrYXZBOGFKc3NCMitRNTZyRUNvdE1oL0dEeEs4ZS9lOVZuTApNODRVK1JYTnpacGxNT2tCSGI1NHZzT2dFbEdIVTJtVHY5cVYxTm1VaGZrOU10ajNURFpyNG5xd2pEVGdRRTJDCmdIS0h5Mnh5RzBNbkYxVDlWNUJQV1UrL09iRTVjcDVkVFJBOEE1YTdEcGtFVXdMdTFHY2p0b2FKMmZ0QWRqTCsKbXZPVG5FdzU4V3AyeGl0Yy91bUhPU3BjUU50Y0JqSE54clBWTE91NkcvN1Vsa3BrUVZPUmZwZUdFNk51bFQwcgp6ZWxjUjdVUTdMSUwyRHJzV2EyR0VYdmpiSzlTamZpNVVwYnUwWXkrRllJSy9Jdmw3RFRDdFA3bmp3SURBUUFCCm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dFQkFHK1FKMVR1Mk5qUVI3VFNrSGZhME0rT2k1K25DU0llYW9CbnA1MUk4MGlMT2MvdgpPRmNRQnplQ3Rtak9jSU9BMnJLL2luWU9mNjNQdVlqdHovT2d3Y0swZFRlVzFuYkI3UVBnMlY1YjRuOXZ1aCs3CitNbDM4a0cwZGdSeiswQkh5QXNqMi9XeDRZM0hsc3daaVZNWkoxVUtIUnN6cit2WnQ1aTl6UUgvQzNxd1lPMGgKWWpjUkFVRlVNd012Mm9iQjZST0ZuTW9zbzE2dXhqN2NDSkpGMm82bHdXSWJWclJ0ZlMyV1JLem40S0QvZk4zWQpEdHRCbDRxZ1VnTVZmb0RZYkZWeTdpdjZZaGJoNXpCcHRZRDVaL1c1c3hlSEExK0pKSnpkVTA3M2ppOUhVWGlFCklHQitCZXJtTmhoejZsb09MOUhsYkxsMlJlSDFjVjFsMmx5Y3Yxaz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBNHc0VFYyZDFNVkIwV2JSajVRUi9mZDVvdm1kaVV4d0x1SThmcGwwaGd3c2pxZ2FCCk9PUG5sU1gyaCthdkE4YUpzc0IyK1E1NnJFQ290TWgvR0R4SzhlL2U5Vm5MTTg0VStSWE56WnBsTU9rQkhiNTQKdnNPZ0VsR0hVMm1UdjlxVjFObVVoZms5TXRqM1REWnI0bnF3akRUZ1FFMkNnSEtIeTJ4eUcwTW5GMVQ5VjVCUApXVSsvT2JFNWNwNWRUUkE4QTVhN0Rwa0VVd0x1MUdjanRvYUoyZnRBZGpMK212T1RuRXc1OFdwMnhpdGMvdW1ICk9TcGNRTnRjQmpITnhyUFZMT3U2Ry83VWxrcGtRVk9SZnBlR0U2TnVsVDByemVsY1I3VVE3TElMMkRyc1dhMkcKRVh2amJLOVNqZmk1VXBidTBZeStGWUlLL0l2bDdEVEN0UDduandJREFRQUJBb0lCQVFEWWN6YWxBQStNYjNJNwpnZWdwRHR5ckZUY3RMRWxqaVR6ek9CMm43dWhma0dMelZ6Z2hEOEpaUU5PQVFyMWRFQXQ4eUZXaW45YjZGcm05CmZkVUxPWThJak84elhlS0ZCRlNpRDlNZHlhM2xybnBON0tJVzJVN2pwNjBtSzJPYVpicW9Lck9YOUQ0UEZ4N0oKSEtoRVEwbkNueldZbDB0dFA4R01mMWxYKy9Cc0grRUpnUEM0cDNDVDRpL1VCcEhSQTFuVVZHcXE1ZE9CeXlqWQpBbjZHeldjNUl3aVd4T3QvMlJISE1Fc3dJMm9HVGNZQ2xRNEk4OHNKOTgwUWN1ZUxFanVIem00cS9sMmw0WU1pCnkwT1RxZmxIVTV3cnA3ZEFHR0RPVkZxSlZKK0FJSHg0NjVLdXpjQnMwUUc5ejVEei9MTWFJUjBBOXZpc0VOWFoKUVJydHdKY2hBb0dCQU9UdUVZRjh5TitlZGRxN3pvRzZsS0lQdHFlTHBBSTd3RkpTOXJlUU9hQTZ4ZzUxbWhHZApsdTlUKzJYUnlINFhFOXpISGIrS1NpTEg5TERUb3JGbDBOK2FMRExJUko0bWxDUFh0TWl0R2lzT0FWVEFmRlhQClV2WkNaMEI5TEhuUXBlM3UwU2hEK1BvQ0NQQlhTUVhWUTJJNC9pRE9WaG1zdGdPMlM5VzByNk03QW9HQkFQM24KUC96SHducmJwcHpqeXlFM1hVaTVRU0NUMGhaRTFLZUtLVmdBS1Jkc0lGc3ZDcEVXRDBvTmlCcHoyZ3pXUS9NMQo5dEdDVWM4c2l4M1VoeTJRVkVWbTZaZ3Jvbkd2cjhvbnhVYUpTTGp6RHpKZXp5WXRNL2lhdXNIR20xbUhlYnY3ClYwL0hnc0JFTlhYZTFEbEpEUXE1V21veWhSMlIwUTZhYzhSb09kKzlBb0dBZmhocmFBbFZrMlp5di9KbVFxcUUKcCtkRDBuRmwreHp5UitZT292azc1SGU3RThmTy94andSQTdjRUM5RzRielFZZkVDLzdlcU1oSTFReGl2S2t0TQppMzBlRHpLa0tRQlM1Sk14cnI4NkJMRUlKcWlIVTdTSW03L2pvMi9QQ2FIVlk0TUJqYzR5MjNJM2ZqcDFyRkxWCmRNcXpuMXBIcm9pbEVOSmVYdTNST0hVQ2dZRUExNHg3ZVFqSkpPM1dPM2p6V0thY3pnRmZ0ZDFvVERsdzR5N2EKdkhlZWF1RURjd1d6amNwUmZvZVFWUXluUDZDakhSVmlEU2o2ZE13VzZtTWp3MTIwL1JwS0UwSnY3TjIrZWZ0YgpjZTlZU3BNbUFwZ1VlZytFQUhpek5aQjdELzJBTGtOSk0xUm52dnZvK3NFS0gvdlJVNXBabExDQTY4Si8zVXJvCkh3UndwVzBDZ1lFQTNhR2p0R1FQUlFCTUtTU3FkOVVJTWhZSTcvUU1mbVJsbytTS0g1bG8zZ0RMZTlPM254WkoKWHo4bmdsWnNSdzk1OEJvM1M4dFhYd1V6QjZFWkM2ZnQwbUdVWm5mcnRtVXhMa21takRQUndLNzQxalF6NE5wLwpGZEk2MVgycE9LRUdQd2ZxWG15eHZEMUNiVUtNdVZINXNNejVyV3JDNk9aeVVBQWVBbk1ZY2dzPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
EOF)

createWcCfg=$(cat > $localPath/kube-bench/cfg/kube_config_eck-wc.yaml << EOF
apiVersion: v1
kind: Config
clusters:
- cluster:
    api-version: v1
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN3akNDQWFxZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKTFdOaE1CNFhEVEl3TURJeU5ERXlNell3TWxvWERUTXdNREl5TVRFeU16WXdNbG93RWpFUU1BNEdBMVVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUtHU096VDBMaUh1CjBBbmpGZDFTOE1JMVZOMkZ3RWRmcXZUSndYQkZvSXlOaEN3YkNDNS9GM3BiUXFZalB5a1h0UjVjUCtsR2NNaXMKYjhqbjBKQU9EM1NyM0NYZzIrRXFhbXZKSkE4YXF0emZxZVc2VXFTcmxtbXVnWEJpREhDVm1oYlhQVFdjN3NQQgo5bnNNV1JxYzV0enZSYThHbTNETjNWRXU0MnczOTZXUTBBYXlGSlh6dXdLWjlMeWtxRDFjSVVyckZJUTRlN1FrClp2anNzYm5XLzFsU1NpeTg1aVdLWU0ydk0yTUhiYXVaUDBtQTBhMWM2ZmtqbjdHUDNmUG5YRWo2N1g5aU5aenQKK0ZKYXdOeEZmcGhES0dNaU16aTN0dWdnQWJqVi9CcytQVTQzTEhSL3hERzNhRUdhWFN2U0dkMWJuSTd4ZERJbQp4VGthdGIwY1N4TUNBd0VBQWFNak1DRXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93UUZNQU1CCkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSWFqNVMxT0lUU1JJUGhzelBWanFLMDlYNGN6ZjBQbEY4SDUKeTlyelEza25waTJBM1ZCL2VHSk9pUkJvVFd4K2VDVWZHZmN3QXBvSExxRDFPT2REbmNyTlZQRmYrcDRuQ0U1cgpFZ1ZwZ0g1UFdaa01Hbm8rMStkQzdGRjN2dHpZTXJKaENWVGN1dEM0ekUyaWxWQy82eGdMazBzaDk5WStHN1FyCjRBV0d3TFFKMGljaUJiMzdtMHBIV2VlTnFTM3lkYzBOZkxsdlhvTGpBTUtKQkw1N1BTWTg2dzVnVFdUQ3I5SFMKQ3JoVlRNQWlDSzRTcTEvSHNXeGNCUFJQeHJOdEIvcUxMVUJFcGVsSWhvTS9jU1Z4bCtFY1M0NTB2eXU4NUpjbgpGdnd5UGkwaUo4Ri8yT0ozOFhQNEtnQ294VUpiK0U3U2EraitwamZXTWZNNksvcTErYkk9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: "https://89.145.167.6:6443"
  name: "eck-workload_cluster"
contexts:
- context:
    cluster: "eck-workload_cluster"
    user: "kube-admin-eck-workload_cluster"
  name: "eck-workload_cluster"
current-context: "eck-workload_cluster"
users:
- name: "kube-admin-eck-workload_cluster"
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2VENDQWRHZ0F3SUJBZ0lJZEkvejVPUEgzYmd3RFFZSktvWklodmNOQVFFTEJRQXdFakVRTUE0R0ExVUUKQXhNSGEzVmlaUzFqWVRBZUZ3MHlNREF5TWpReE1qTTJNREphRncwek1EQXlNakV4TWpNMk1ESmFNQzR4RnpBVgpCZ05WQkFvVERuTjVjM1JsYlRwdFlYTjBaWEp6TVJNd0VRWURWUVFERXdwcmRXSmxMV0ZrYldsdU1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTJ1QkkvOTV0MmFUdWlnbmdqYW5zRy8xVDZkTGEKTDdWR1h5RTNhVSs2UkFWaWQzNElNOFB5NWk2S2hnVkpsSmxRbzJ6cnlRV3pwTnY4U0g0NEFKZzNGSXI1dzlVMgoremsrUWhCSUtrMDNVUGUrdGh4VXFHREZEbVZ2YktXR0VCMk5CdG1XSEhLNkZ1Z0c2b2ZDVlJ2LzFFc2FjVEdJCktzLy9RL1U2NCtKZnZwTGlEVFQ0VXVXdGNYVEVuOFRreVRqckFKWEx6bGdlb3hwTjQwWTdyWUJZTXZDVWxQcUIKblF5cHArTUhEQzFFZUpCNHc1TW5haHBJUEJXYlZWTTRRRTJEeHBoQlZxUXVycnFja04zKzI2Q0x5ZEVhcWRZOAovNWFRSTRHZHJkZk5BVU4zN3I2Z1BiVjNISUttb3A0TFRNM2FORVpkeVRNaEdISDRzMHNHaWdzOFd3SURBUUFCCm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dFQkFGSG5lYkdCYzhGc1RWUHVCL055RVFtRWluNVU2T1VwbDdmN3c1WmMrWUJlRGVQaAphUmVJa3hENW5RakszSDd6dVVIOGhDTmVSb1VySDhJb1FWdkwrY3ZJL2F0V0VVU0RhbDRhV3Yrend6UU1QS3F3CitYTXA1RldlU3FUUHJmZEloVzVBZExnRHdxL3dOcmdnYXAzeFVuK3dtNjZsbVA1T2RKNS9HbGJrMUN5SVF6NTAKaXpuM1lsZ2tFd0g4bXhzMEtBT2xRdlhWNGYzQzY1Ynlack1jeGkrTnlOUlBDWm1OcTYxbVZJQmNXaHI5ZmNGZQpEQmlXQTlZS0NIVlNjTGJkbzhUSUROZGZ1RzdISXI5ZDJ6cVdwaWxlVDJ1OVVYT05KUDZ6eFlsTk1mTDhyM2JyClpCVGFqUXRGeUFMWWRLODJoVDRYeGk2aVppRUFVSVlSMHROR0xncz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBMnVCSS85NXQyYVR1aWduZ2phbnNHLzFUNmRMYUw3VkdYeUUzYVUrNlJBVmlkMzRJCk04UHk1aTZLaGdWSmxKbFFvMnpyeVFXenBOdjhTSDQ0QUpnM0ZJcjV3OVUyK3prK1FoQklLazAzVVBlK3RoeFUKcUdERkRtVnZiS1dHRUIyTkJ0bVdISEs2RnVnRzZvZkNWUnYvMUVzYWNUR0lLcy8vUS9VNjQrSmZ2cExpRFRUNApVdVd0Y1hURW44VGt5VGpyQUpYTHpsZ2VveHBONDBZN3JZQllNdkNVbFBxQm5ReXBwK01IREMxRWVKQjR3NU1uCmFocElQQldiVlZNNFFFMkR4cGhCVnFRdXJycWNrTjMrMjZDTHlkRWFxZFk4LzVhUUk0R2RyZGZOQVVOMzdyNmcKUGJWM0hJS21vcDRMVE0zYU5FWmR5VE1oR0hINHMwc0dpZ3M4V3dJREFRQUJBb0lCQVFDellqNXg5Z3B4NWdyYQpkMTNpdlBFVnYzbVdtWWpZc09rTDdsMUxvbHcyZzNOQUc3cjlNZ3RSTzdPc1E0a2FrTXpXSTk3YTBpRjViQkpJCkY2b3VVcEpSODlUZiswOGtkclhmenhoV0V4TFMrVGtFYUJPNkxCVlV4eTJiRGMzaVIxWGQxMVovMmtkSm5zQ00KVnRlZWlXUVN5YnJTS3BZL0FGbGxpUWJLM2kwNk1nS28rRlFQWEl3QXFEdkJmY1RTVktGZDdsTlFGeHRDK3ZMdQpRZ2ovZFdoSXlWbWMvT2xUKzVDelNkbDJMU2E0Skkya3c4eXRoY0pqSmQ2YnhqRDNUdlhCdG5oUnR1RFhLWUxzClMzS1VVNGZ6NVYzOE02blVvQlBLdzFzbWt4RGxPMWFZRkVhSDE5TlBXK3FUMFhmbFo4S0NCdlZUa0Ftd0JnSHAKbmRPUUhwR0JBb0dCQU53V2JJQmc4ZjhQN2UrVTZoRW9yQ2lOZUhieGtXZnhBR2UvdHZRNmtUWHlmbktNV0pLbwp5anRaaGpMZlpJZVB5MndBN2VNZHdJRXYvQ2p4QmU3SVB4NEFvclQwVERPRURxdis5K0lKVmtxN0NCQVc3WVR0CmJuZnprbW5laVJPR2dtbEg5K3J0YlJmck5nUElIS1lhWUkxUmdxZjBIdmpheGRxZXRnSkdJeUVmQW9HQkFQNlgKUVVhNHdVdmVRL2gwencyQnhjaUp3OHhLZG05L2xxRTd5VWI3K25XY1orY2h4RXZCclQ4dkM5dVNaOEIzMm5OdgpxMXhRT20rSlJzLzBCc05yRjdjUHk2SjF5eDZQWENBTkkvYXhlRUY2MjBJVkpweTdHUzhXNHpPY0pZSmhtMVJDClhqMmJMU3V2RGF6cndqeEtKUjg4alUySlo1amY0REZnSjlQdFY5RkZBb0dCQUluczU1eGdwT2V5cE90RENKa3UKUXcyNjh1YWZwdjlic21SU2FpYU9XWmhVV3RnUWlpV0c4QTNYb2RsWjFGZDhUd0JsYUsrdllvZlRlWlJ5ejhQLwo3RVl5SWNXRFlBbmMxWkVHWFhSalk1ZTd0R2JZNTRzcGZOUmhhYjA5UCt4am5IQzhNR3NpMWY1cVlsUm1ZVVhiCk8rejBTd3hVV2VDY3dlZXJGT2RCNnh3REFvR0JBS2RiTkp6UnpMY2J4K0Ntb0lsSGVvV0dFa0RUM2lFVFpTaGUKRGNUczFVckU0d1JzRFFhanJVZ3duQUhkcnZnMWtWTjYzOUdTSjZlMFBPbHNoNW1rWjNWK0c2V1MrMC8rZTFmUwphNGE2U012NmYvRmp4L3NWZnN1V3B3b0JKaU1jR0toOTdFZGhINE5zMG5lT2p5Tmt0aHhmaUora3FJWTAvTUpZCmJEWUMra3hsQW9HQVN6NFByRjBaNkJ4bWE2U29NVXpoVEFhWFRBSUxCODlFbzk1WkJGRG1rT2xlcFNUTVR1V3UKa1lpWDN5Szkxcmk0YWtaOE1DSXppbWI5OVRGVWRmdTdEc2E0c2xRdys4TEthQUdmUXlzUE5rdHEzdllRZWpibwpmVm16eUJvZTBIanpJa2tEZGx5OXJpYlFUSGxpS0QrKzlVTStiMncvWlBLZ0RwUnUvM3hWM2VJPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
EOF)

createContainerScript=$(cat > $localPath/pipeline/test/services/container-entrypoint.sh << 'EOF'
#!/bin/bash
createCreds="source /home/ck8s/pipeline/test/services/credentials.sh"
exportScCfg="export KUBECONFIG=/home/ck8s/kube-bench/cfg/kube_config_eck-sc.yaml"
runScTest="bash /home/ck8s/pipeline/test/services/test-sc.sh"
exportWcCfg="export KUBECONFIG=/home/ck8s/kube-bench/cfg/kube_config_eck-wc.yaml"
runWcTest="bash /home/ck8s/pipeline/test/services/test-wc.sh"

eval $createCreds
eval $exportScCfg
eval $runScTest
eval $exportWcCfg
eval $runWcTest
EOF)

makeExec="chmod +x $localPath/pipeline/test/services/container-entrypoint.sh"
dockerRun="docker run -it -v $localPath:/home/ck8s --entrypoint=/home/ck8s/pipeline/test/services/container-entrypoint.sh elastisys/ck8s-ops:$repoTag"

#
# Execute commands in the right order
#
eval $createCreds
eval $createScCfg
eval $createWcCfg
eval $createContainerScript
eval $makeExec
eval $dockerRun
